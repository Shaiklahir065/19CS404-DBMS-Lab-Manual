# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
--From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
 

For example:

Result
ord_no      purch_amt   ord_date    customer_id  salesman_id
----------  ----------  ----------  -----------  -----------
70002       65.26       2012-10-05  3002         5001
70005       2400.6      2012-07-27  3007         5001
70008       5760.0      2012-09-10  3002         5001
70013       3045.6      2012-04-25  3002         5001


```sql
-- SELECT ord_no, purch_amt, ord_date, customer_id, Orders.salesman_id
FROM Orders
JOIN Salesman ON Orders.salesman_id = Salesman.salesman_id
WHERE Salesman.city = 'New York';
```

**Output:**

![image](https://github.com/user-attachments/assets/28ffd1f7-ed4b-43c6-88ff-1568829a3d61)


**Question 2**
---
-- From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
```sql
--SELECT ord_no, purch_amt, ord_date, customer_id, Orders.salesman_id
FROM Orders
JOIN Salesman ON Orders.salesman_id = Salesman.salesman_id
WHERE Salesman.city = 'London';
```

**Output:**

![image](https://github.com/user-attachments/assets/eda24b8f-7952-473f-b55a-db27ac4ebc4f)


**Question 3**
---
--Write a SQL query to Retrieve the medications with dosages equal to the lowest dosage

Table Name: Medications (attributes: medication_id, medication_name, dosage)


```sql
-- SELECT medication_id AS medic, medication_name, dosage
FROM Medications
WHERE dosage = (
    SELECT MIN(dosage)
    FROM Medications
);
```

**Output:**

![image](https://github.com/user-attachments/assets/fc0515c6-3c3d-4f95-9ea1-c5097c095e8b)


**Question 4**
---
-- Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose Address as Delhi and age below 30

Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh     32              Ahmedabad     2000
2          Khilan        25              Delhi                 1500
3          Kaushik      23              Kota                  2000
4          Chaitali       25             Mumbai            6500
5          Hardik        27              Bhopal              8500
6          Komal         22              Hyderabad       4500

7           Muffy          24              Indore            10000



```sql
-- SELECT *
FROM CUSTOMERS 
WHERE ADDRESS = 'Delhi' AND AGE < 30
ORDER BY ID ASC;
```

**Output:**

![image](https://github.com/user-attachments/assets/2e9267d3-9c06-49be-a991-c4a6229de83a)


**Question 5**
---
-- Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose Address as Delhi

Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh     32              Ahmedabad     2000
2          Khilan        25              Delhi                 1500
3          Kaushik      23              Kota                  2000
4          Chaitali       25             Mumbai            6500
5          Hardik        27              Bhopal              8500
6          Komal         22              Hyderabad       4500

7           Muffy          24              Indore            10000

```sql
-- SELECT *
FROM CUSTOMERS 
WHERE ADDRESS = 'Delhi'; 
```

**Output:**

![image](https://github.com/user-attachments/assets/661f48c3-ec1c-43b6-bf76-6c773fd39a1e)


**Question 6**
---
-- Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the minimum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)


```sql
-- SELECT g.student_name, g.grade
FROM GRADES g
JOIN (
    SELECT subject, MIN(grade) AS min_grade
    FROM GRADES
    GROUP BY subject
) min_grades
ON g.subject = min_grades.subject AND g.grade = min_grades.min_grade;

```

**Output:**
![image](https://github.com/user-attachments/assets/0670bb1f-99a0-401a-ae9f-486cb966b179)


**Question 7**
---
-- Write a SQL query to Identify customers whose city is different from the city of the customer with the highest ID

SAMPLE TABLE: customer

name             type
---------------  ---------------
id               INTEGER
name             TEXT
city             TEXT
email            TEXT
phone            INTEGER

```sql
-- SELECT *
FROM customer
WHERE city != (
    SELECT city
    FROM customer
    ORDER BY id DESC
    LIMIT 1
);

```

**Output:**

![image](https://github.com/user-attachments/assets/36fd8ced-0dc2-4491-9997-e56e8b58d3fb)

**Question 8**
---
--From the following tables write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.

salesman table

name                 type
---------------   ---------------
salesman_id       numeric(5)
name                  varchar(30)
city                     varchar(15)
commission       decimal(5,2)

customer table

name              type
-----------       ----------
customer_id   int
cust_name     text
city                text
grade            int
salesman_id  int

```sql
-- SELECT s.salesman_id, s.name
FROM salesman s
JOIN customer c ON s.salesman_id = c.salesman_id
GROUP BY s.salesman_id, s.name
HAVING COUNT(*) > 1;
```

**Output:**

![image](https://github.com/user-attachments/assets/aa490de4-f5c6-4d96-8095-997f6fb8508f)

**Question 9**
---
-- Write a SQL query to Retrieve the medications with dosages equal to the highest dosage

Table Name: Medications (attributes: medication_id, medication_name, dosage)



```sql
-- SELECT medication_id, medication_name, dosage
FROM Medications
WHERE dosage = (SELECT MAX(dosage) FROM Medications);
```

**Output:**

![image](https://github.com/user-attachments/assets/bada6b0f-3149-4b76-81e2-9ea1e9559453)


**Question 10**
---
--Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is EQUAL TO $1500.

Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh     32              Ahmedabad     2000
2          Khilan        25              Delhi                 1500
3          Kaushik      23              Kota                  2000
4          Chaitali       25             Mumbai            6500
5          Hardik        27              Bhopal              8500
6          Komal         22              Hyderabad       4500

7           Muffy          24              Indore            10000

 
 

```sql
-- SELECT *
FROM CUSTOMERS
WHERE SALARY = 1500;


```

**Output:**

![image](https://github.com/user-attachments/assets/4ed5e798-56d6-4826-8e4c-12cd8cb1e862)



## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
